# セキュリティガイド

## 🔒 デフォルト値について（重要）

### なぜデフォルト値があるのか？

このアプリケーションは**開発・検証用のMVP**として設計されており、すぐに動作することを重視しています。

```python
# database.py
self.password = os.getenv("DB_PASSWORD", "password")  # デフォルト: "password"
```

### セキュリティ上の考慮事項

#### ✅ 安全な理由
1. **環境変数優先**: 実際の環境では環境変数が優先される
2. **Git除外**: 実際のパスワードは`.env`ファイル（Git管理外）に保存
3. **ローカル開発のみ**: デフォルト値はローカル開発でのみ使用を想定

#### ⚠️ 注意が必要な場面
- パブリックなサーバーでデプロイする場合
- データベースに機密情報が含まれる場合
- インターネットからアクセス可能な環境での使用

## 🛡️ セキュリティ強化手順

### Step 1: 環境変数ファイルの作成
```bash
# テンプレートをコピー
cp .env.example .env

# 実際の値に変更
nano .env
```

### Step 2: 強力なパスワードの設定
```bash
# .envファイル
DB_PASSWORD=MyVerySecurePassword123!@#
SECRET_KEY=randomly_generated_256_bit_key
```

### Step 3: データベースユーザーの作成
```sql
-- rootの代わりに専用ユーザーを作成
CREATE USER 'conceptcraft_user'@'localhost' IDENTIFIED BY 'secure_password';
GRANT SELECT, INSERT, UPDATE, DELETE ON tantan_app.* TO 'conceptcraft_user'@'localhost';
```

### Step 4: ファイアウォール設定
```bash
# データベースポートを外部から遮断
sudo ufw deny 3306
```

## 🔍 セキュリティ検証

### 設定確認コマンド
```bash
# 1. 環境変数が正しく読み込まれているか
curl http://localhost:8000/debug/info

# 2. データベース接続状態
curl http://localhost:8000/health/detailed

# 3. 実際のパスワードが表示されないことを確認
# （上記コマンドでパスワードが見えたら設定エラー）
```

### チェックリスト
- [ ] `.env`ファイルを作成済み
- [ ] デフォルトパスワード（"password"）を変更済み
- [ ] 専用データベースユーザーを作成済み
- [ ] `.env`が`.gitignore`に含まれていることを確認済み
- [ ] SECRET_KEYをランダム生成済み

## 📊 リスク評価

| リスク | 影響度 | 対策状況 | 推奨アクション |
|--------|--------|----------|----------------|
| デフォルトパスワード使用 | 中 | 環境変数で回避可能 | `.env`ファイル作成 |
| SQLインジェクション | 高 | 対策済み | なし |
| CSRF攻撃 | 中 | Cookie設定で軽減 | なし |
| ブルートフォース攻撃 | 中 | レート制限実装済み | なし |

## 🚨 インシデント対応

### デフォルトパスワードでアクセスされた疑いがある場合

1. **即座に対応**
   ```bash
   # 環境変数でパスワード変更
   echo "DB_PASSWORD=new_secure_password" >> .env
   
   # アプリケーション再起動
   ```

2. **データベースパスワード変更**
   ```sql
   ALTER USER 'root'@'localhost' IDENTIFIED BY 'new_secure_password';
   ```

3. **ログ確認**
   ```bash
   # 不審なアクセスログをチェック
   grep "Signup attempt" logs/app.log
   ```

## 💡 セキュリティベストプラクティス

### 開発環境
- デフォルト値での使用は問題なし
- ローカルネットワークのみでアクセス

### ステージング環境
- 環境変数ファイル（`.env`）を必ず作成
- 本番に近いセキュリティ設定

### 本番環境
- 全ての環境変数を強力な値に設定
- データベース暗号化を検討
- 定期的なセキュリティ監査

## 📞 サポート

セキュリティに関する質問や懸念がある場合は、以下の情報と共にお問い合わせください：

1. 使用予定の環境（開発/ステージング/本番）
2. セキュリティ要件
3. 具体的な懸念事項

適切なセキュリティ設定をサポートいたします。